generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Вправа
model Exercise {
  id              Int               @id @default(autoincrement())
  title           String            @unique
  description     String
  images          ExerciseImage[]
  videos          ExerciseVideo[]
  muscles         ExerciseMuscle[]
  routines        RoutineExercise[]
  workoutExercise WorkoutExercise[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
}

// Зображення вправи
model ExerciseImage {
  id         Int      @id @default(autoincrement())
  exerciseId Int
  path       String
  order      Int
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@index([exerciseId])
}

// Відео вправи
model ExerciseVideo {
  id         Int      @id @default(autoincrement())
  exerciseId Int
  path       String
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@index([exerciseId])
}

// Зв'язок Вправа-М'язи (Many-to-Many)
model ExerciseMuscle {
  exerciseId Int
  muscleId   Int
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  muscle     Muscle   @relation(fields: [muscleId], references: [id], onDelete: Cascade)

  @@id([exerciseId, muscleId])
}

// Рутина (план тренування)
model Routine {
  id          Int               @id @default(autoincrement())
  title       String            @unique
  description String?
  categoryId  Int?
  category    RoutineCategory?  @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  exercises   RoutineExercise[]
  workouts    Workout[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

// Категорії програм тренувань
model RoutineCategory {
  id          Int       @id @default(autoincrement())
  nameEn      String    @unique
  nameUa      String    @unique
  description String
  icon        String? // emoji або назва іконки
  color       String? // hex колір для UI
  routines    Routine[]
}

// Вправи в рутині
model RoutineExercise {
  id         Int      @id @default(autoincrement())
  routineId  Int
  exerciseId Int
  order      Int
  reps       Int?
  sets       Int?
  duration   Int? // seconds
  rest       Int? // seconds
  routine    Routine  @relation(fields: [routineId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([routineId, exerciseId, order])
}

// Тренування (фактично виконана рутина)
model Workout {
  id        Int               @id @default(autoincrement())
  routineId Int?
  title     String
  startTime DateTime
  endTime   DateTime
  totalTime Int // seconds
  routine   Routine?          @relation(fields: [routineId], references: [id], onDelete: SetNull)
  exercises WorkoutExercise[]
  muscles   WorkoutMuscle[]
  createdAt DateTime          @default(now())

  @@index([endTime])
}

// Вправи виконані в тренуванні
model WorkoutExercise {
  id         Int          @id @default(autoincrement())
  workoutId  Int
  exerciseId Int
  order      Int
  workout    Workout      @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise   Exercise     @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  sets       WorkoutSet[]

  @@index([workoutId])
}

// Сети виконані в вправі
model WorkoutSet {
  id                Int             @id @default(autoincrement())
  workoutExerciseId Int
  setNumber         Int
  reps              Int?
  duration          Int? // seconds
  weight            Float? // for future expansion
  completedAt       DateTime
  workoutExercise   WorkoutExercise @relation(fields: [workoutExerciseId], references: [id], onDelete: Cascade)

  @@index([workoutExerciseId])
}

// М'язи задіяні в тренуванні (Many-to-Many)
model WorkoutMuscle {
  workoutId Int
  muscleId  Int
  workout   Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  muscle    Muscle  @relation(fields: [muscleId], references: [id], onDelete: Cascade)

  @@id([workoutId, muscleId])
}

// Список всіх м'язів
model Muscle {
  id          Int              @id @default(autoincrement())
  nameEn      String           @unique
  nameUa      String           @unique
  description String
  exercises   ExerciseMuscle[]
  groups      MuscleToGroup[]
  workouts    WorkoutMuscle[]
}

// Групи м'язів
model MuscleGroup {
  id          Int             @id @default(autoincrement())
  nameEn      String          @unique
  nameUa      String          @unique
  description String
  muscles     MuscleToGroup[]
}

// Зв'язок М'язи-Група (Many-to-Many)
model MuscleToGroup {
  muscleId Int
  groupId  Int
  muscle   Muscle      @relation(fields: [muscleId], references: [id], onDelete: Cascade)
  group    MuscleGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([muscleId, groupId])
}
